{"version":3,"file":"viewer.mjs","sources":["../out/framecontainer/createIframe.js","../out/framecontainer/viewerParameters.js","../out/framecontainer/viewerConfig.js","../node_modules/@ampproject/viewer-messaging/messaging.js","../out/framecontainer/rendering-modules/IframeHeight.js","../out/framecontainer/rendering-modules/ErrorHandler.js","../out/framecontainer/rendering-modules/index.js","../out/preprocessing/preprocessing-modules/Validator.js","../out/preprocessing/preprocessing-modules/index.js","../out/preprocessing/preprocess.js","../out/framecontainer/FrameContainer.js"],"sourcesContent":["/**\n * Creates an iframe element with the provided options that includes sandbox\n * attributes, feature policy and styles.\n *\n * @param {!HTMLElement} parent Element to create an iframe inside of\n * @param {!IframeOptions} options Options used for the iframe\n * @return {!HTMLIFrameElement} Newly created iframe element\n */\nexport function createIframe(parent, options) {\n    const doc = parent.ownerDocument;\n    const iframe = doc.createElement('iframe');\n    if (options.width) {\n        iframe.setAttribute('width', options.width);\n    }\n    if (options.height) {\n        iframe.setAttribute('height', options.height);\n    }\n    iframe.setAttribute('allow', stringIfArray(options.featurePolicy, '; '));\n    iframe.setAttribute('loading', 'eager');\n    if (options.className) {\n        iframe.className = options.className;\n    }\n    if (options.styles) {\n        iframe.style.cssText = stringIfArray(options.styles, '; ');\n    }\n    if (options.sandbox) {\n        iframe.setAttribute('sandbox', stringIfArray(options.sandbox, ' '));\n    }\n    if (options.src) {\n        iframe.src = options.src || '';\n    }\n    if (options.srcdoc) {\n        iframe.setAttribute('srcdoc', options.srcdoc);\n    }\n    if (options.name) {\n        iframe.name = options.name;\n    }\n    parent.prepend(iframe);\n    return iframe;\n}\nfunction stringIfArray(input, joiner) {\n    if (!input) {\n        return '';\n    }\n    if (Array.isArray(input)) {\n        return input.join(joiner);\n    }\n    return input;\n}\n//# sourceMappingURL=createIframe.js.map","/**\n * AMP Viewer capabilities that can be specified in the `cap` parameter.\n *\n * @see {@link https://github.com/ampproject/amphtml/blob/master/extensions/amp-viewer-integration/CAPABILITIES.md}\n */\nexport var ViewerCapability;\n(function (ViewerCapability) {\n    ViewerCapability[\"A2A\"] = \"a2a\";\n    ViewerCapability[\"CLIENT_ID_SERVICE\"] = \"cid\";\n    ViewerCapability[\"ERROR_REPORTER\"] = \"errorReporter\";\n    ViewerCapability[\"FRAGMENT\"] = \"fragment\";\n    ViewerCapability[\"HANDSHAKEPOLL\"] = \"handshakepoll\";\n    ViewerCapability[\"NAVIGATE_TO\"] = \"navigateTo\";\n    ViewerCapability[\"REPLACE_URL\"] = \"replaceUrl\";\n    ViewerCapability[\"SWIPE\"] = \"swipe\";\n    ViewerCapability[\"VIEWER_RENDER_TEMPLATE\"] = \"viewerRenderTemplate\";\n    ViewerCapability[\"XHR_INTERCEPTOR\"] = \"xhrInterceptor\";\n})(ViewerCapability || (ViewerCapability = {}));\n/**\n * AMP Viewer viewport types that can be specified in the `viewportType`\n * parameter.\n */\nexport var ViewerViewportType;\n(function (ViewerViewportType) {\n    ViewerViewportType[\"NATURAL\"] = \"natural\";\n    ViewerViewportType[\"NATURAL_IOS_EMBED\"] = \"natural-ios-embed\";\n})(ViewerViewportType || (ViewerViewportType = {}));\n/**\n * AMP Viewer visibility states that can be specified in the `visibilityState`\n * parameter.\n */\nexport var ViewerVisibilityState;\n(function (ViewerVisibilityState) {\n    ViewerVisibilityState[\"INACTIVE\"] = \"inactive\";\n    ViewerVisibilityState[\"PAUSED\"] = \"paused\";\n    ViewerVisibilityState[\"VISIBLE\"] = \"visible\";\n    ViewerVisibilityState[\"PRERENDER\"] = \"prerender\";\n    ViewerVisibilityState[\"HIDDEN\"] = \"hidden\";\n})(ViewerVisibilityState || (ViewerVisibilityState = {}));\n/**\n * AMP Viewer parameters are provided as a query string that follows a fragment\n * identifier (#). For example, https://amp.example/page.html#foo=1&bar=2\n *\n * This function appends the given parameters in the correct format to an\n * existing URL.\n *\n * @param {string} url URL to append parameters to\n * @param {ViewerParameters=} parameters Viewer parameters to append\n * @return {string} URL with appended parameters\n */\nexport function appendParametersToURL(url, parameters) {\n    if (!parameters) {\n        return url;\n    }\n    return url + '#' + parametersToString(parameters);\n}\nexport function parametersToString(parameters) {\n    const output = [];\n    for (const key of Object.keys(parameters)) {\n        // cast to 'any' to allow [] access\n        // tslint:disable:no-any\n        let value = parameters[key];\n        if (typeof value === 'undefined') {\n            continue;\n        }\n        if (typeof value === 'boolean') {\n            value = value ? 1 : 0;\n        }\n        output.push(`${encodeURIComponent(key)}=${encodeURIComponent(value)}`);\n    }\n    return output.join('&');\n}\n//# sourceMappingURL=viewerParameters.js.map","import { ViewerCapability, ViewerVisibilityState, } from './viewerParameters';\n/**\n * Feature-Policy of the iframe that displays an AMP page.\n *\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Feature-Policy}\n */\nexport const IFRAME_FEATURE_POLICY = [\n    \"autoplay 'none'\",\n    \"camera 'none'\",\n    \"encrypted-media 'none'\",\n    \"fullscreen 'none'\",\n    \"geolocation 'none'\",\n    \"gyroscope 'none'\",\n    \"magnetometer 'none'\",\n    \"microphone 'none'\",\n    \"midi 'none'\",\n    \"payment 'none'\",\n    \"speaker 'none'\",\n    \"sync-xhr 'none'\",\n    \"vr 'none'\",\n];\n/**\n * Default sandbox attributes of the iframe that displays an AMP page.\n *\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe}\n */\nexport const IFRAME_SANDBOX = [\n    'allow-scripts',\n    'allow-forms',\n    'allow-popups',\n    'allow-popups-to-escape-sandbox',\n];\n/**\n * Default styles applied to the iframe that displays an AMP page.\n */\nexport const IFRAME_STYLES = ['border: none', 'overflow: hidden'];\n/**\n * Default viewer parameters used for the AMP viewer.\n */\nexport const VIEWER_PARAMETERS = {\n    prerenderSize: 0,\n    visibilityState: ViewerVisibilityState.VISIBLE,\n    paddingTop: 0,\n    history: true,\n    p2r: false,\n    horizontalScrolling: false,\n    storage: true,\n    development: false,\n    log: false,\n    csi: true,\n    cap: [\n        ViewerCapability.XHR_INTERCEPTOR,\n        ViewerCapability.ERROR_REPORTER,\n    ],\n};\n/**\n * Rendering modules used by default.\n */\nexport const DEFAULT_RENDERING_MODULES = ['IframeHeight', 'ErrorHandler'];\n//# sourceMappingURL=viewerConfig.js.map","/**\n * Copyright 2017 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst TAG = 'amp-viewer-messaging';\nconst CHANNEL_OPEN_MSG = 'channelOpen';\nconst HANDSHAKE_POLL_MSG = 'handshake-poll';\nconst APP = '__AMPHTML__';\n\n/**\n * @enum {string}\n */\nconst MessageType = {\n  REQUEST: 'q',\n  RESPONSE: 's',\n};\n\n/**\n * @typedef {function(string, *, boolean):(!Promise<*>|undefined)}\n */\nlet RequestHandler; // eslint-disable-line no-unused-vars\n\n/**\n * @param {*} message\n * @return {?AmpViewerMessage}\n */\nexport function parseMessage(message) {\n  if (typeof message != 'string') {\n    return /** @type {AmpViewerMessage} */ (message);\n  }\n  if (message.charAt(0) != '{') {\n    return null;\n  }\n\n  try {\n    return /** @type {?AmpViewerMessage} */ (JSON.parse(\n      /** @type {string} */ (message)\n    ));\n  } catch (e) {\n    return null;\n  }\n}\n\n/**\n * @fileoverview This class is a de-facto implementation of MessagePort\n * from Channel Messaging API:\n * https://developer.mozilla.org/en-US/docs/Web/API/Channel_Messaging_API\n */\nexport class WindowPortEmulator {\n  /**\n   * @param {!Window} win\n   * @param {string} origin\n   * @param {!Window} target\n   */\n  constructor(win, origin, target) {\n    /** @const @private {!Window} */\n    this.win_ = win;\n    /** @const @private {string} */\n    this.origin_ = origin;\n    /** @const @private {!Window} */\n    this.target_ = target;\n  }\n\n  /**\n   * @param {string} eventType\n   * @param {function(!Event):*} handler\n   */\n  addEventListener(eventType, handler) {\n    this.win_.addEventListener('message', event => {\n      if (event.origin == this.origin_ && event.source == this.target_) {\n        handler(event);\n      }\n    });\n  }\n\n  /**\n   * @param {JsonObject} data\n   */\n  postMessage(data) {\n    // Opaque (null) origin can only receive messages sent to \"*\"\n    const targetOrigin = this.origin_ === 'null' ? '*' : this.origin_;\n\n    this.target_./*OK*/ postMessage(data, targetOrigin);\n  }\n\n  /**\n   * Starts the sending of messages queued on the port.\n   */\n  start() {}\n}\n\n/**\n * @fileoverview This is used in amp-viewer-integration.js for the\n * communication protocol between AMP and the viewer. In the comments, I will\n * refer to the communication as a conversation between me and Bob. The\n * messaging protocol should support both sides, but at this point I'm the\n * ampdoc and Bob is the viewer.\n */\nexport class Messaging {\n  /**\n   * Performs a handshake and initializes messaging.\n   *\n   * Requires the `handshakepoll` viewer capability and the `origin` viewer parameter to be specified.\n   * @param {!Window} target - window containing AMP document to perform handshake with\n   * @param {?string=} opt_token - message token to verify on incoming messages (must be provided as viewer parameter)\n   * @return {!Promise<!Messaging>}\n   */\n  static initiateHandshakeWithDocument(target, opt_token) {\n    return new Promise(resolve => {\n      const intervalRef = setInterval(() => {\n        let channel;\n        try {\n          channel = new MessageChannel();\n        } catch (err) {\n          console.log(err, 'err');\n        }\n        const pollMessage = /** @type {JsonObject} */ ({\n          app: APP,\n          name: HANDSHAKE_POLL_MSG,\n        });\n        target./*OK*/ postMessage(pollMessage, '*', [channel.port2]);\n\n        const port = channel.port1;\n        const listener = event => {\n          const message = parseMessage(event.data);\n          if (!message) {\n            return;\n          }\n          if (message.app === APP && message.name === CHANNEL_OPEN_MSG) {\n            clearInterval(intervalRef);\n            port.removeEventListener('message', listener);\n            const messaging = new Messaging(\n              null,\n              port,\n              /* opt_isWebview */ false,\n              opt_token,\n              /* opt_verifyToken */ true\n            );\n            messaging.sendResponse_(message.requestid, CHANNEL_OPEN_MSG, null);\n            resolve(messaging);\n          }\n        };\n        port.addEventListener('message', listener);\n        port.start();\n      }, 1000);\n    });\n  }\n\n  /**\n   * Waits for handshake from iframe and initializes messaging.\n   *\n   * Requires the `origin` viewer parameter to be specified.\n   * @param {!Window} source - the source window containing the viewer\n   * @param {!Window} target - window containing AMP document to perform handshake with (usually contentWindow of iframe)\n   * @param {string} origin - origin of target window (use \"null\" if opaque)\n   * @param {?string=} opt_token - message token to verify on incoming messages (must be provided as viewer parameter)\n   * @return {!Promise<!Messaging>}\n   */\n  static waitForHandshakeFromDocument(source, target, origin, opt_token) {\n    return new Promise(resolve => {\n      debugger;\n      const listener = event => {\n        debugger;\n        const message = parseMessage(event.data);\n        if (!message) {\n          return;\n        }\n        if (\n          event.origin == origin &&\n          (!event.source || event.source == target) &&\n          message.app === APP &&\n          message.name === CHANNEL_OPEN_MSG\n        ) {\n          source.removeEventListener('message', listener);\n          const port = new WindowPortEmulator(source, origin, target);\n          const messaging = new Messaging(\n            null,\n            port,\n            /* opt_isWebview */ false,\n            opt_token,\n            /* opt_verifyToken */ true\n          );\n          messaging.sendResponse_(message.requestid, CHANNEL_OPEN_MSG, null);\n          resolve(messaging);\n        }\n      };\n      source.addEventListener('message', listener);\n    });\n  }\n\n  /**\n   * Conversation (messaging protocol) between me and Bob.\n   * @param {?Window} win\n   * @param {!MessagePort|!WindowPortEmulator} port\n   * @param {boolean=} opt_isWebview\n   * @param {?string=} opt_token\n   * @param {boolean=} opt_verifyToken\n   */\n  constructor(win, port, opt_isWebview, opt_token, opt_verifyToken) {\n    /** @const @private {?Window} */\n    this.win_ = win;\n    /** @const @private {!MessagePort|!WindowPortEmulator} */\n    this.port_ = port;\n    /** @const @private */\n    this.isWebview_ = !!opt_isWebview;\n\n    /**\n     * A token that the viewer may include as an init parameter to enhance\n     * security for communication to opaque origin (a.k.a. null origin) AMP\n     * documents.\n     *\n     * For an AMP document embedded inside a sandbox iframe, the origin of the\n     * document would be \"null\", which defeats the purpose of an origin check.\n     * An attacker could simply create a sandboxed, malicious iframe (therefore\n     * having null origin), walk on the DOM frame tree to find a reference to\n     * the viewer iframe (this is not constrained by the same origin policy),\n     * and then send postMessage() calls to the viewer frame and pass the\n     * viewer's origin checks, if any.\n     *\n     * The viewer could also check the source of the message to be a legitimate\n     * AMP iframe window, but the attacker could bypass that by navigating the\n     * legitimate AMP iframe window away to a malicious document. Recent\n     * browsers have banned this kind of attack, but it's tricky to rely on it.\n     *\n     * To prevent the above attack in a null origin AMP document, the viewer\n     * should include this token in an init parameter, either in the `src` or\n     * `name` attribute of the iframe, and then verify that this token is\n     * included in all the messages sent from AMP to the viewer. The attacker\n     * would not be able to steal this token under the same origin policy,\n     * because the token is inside the viewer document at a different origin\n     * and the attacker can't access it.\n     * @const @private {?string}\n     */\n    this.token_ = opt_token || null;\n\n    /**\n     * If true, the token above is verified on incoming messages instead of\n     * being attached to outgoing messages.\n     * @const @private {boolean}\n     */\n    this.verifyToken_ = !!opt_verifyToken;\n\n    /** @private {number} */\n    this.requestIdCounter_ = 0;\n    /** @private {!Object<number, {resolve: function(*), reject: function(!Error)}>} */\n    this.waitingForResponse_ = {};\n    /**\n     * A map from message names to request handlers.\n     * @private {!Object<string, !RequestHandler>}\n     */\n    this.messageHandlers_ = {};\n\n    /** @private {?RequestHandler} */\n    this.defaultHandler_ = null;\n\n    this.port_.addEventListener('message', this.handleMessage_.bind(this));\n    this.port_.start();\n  }\n\n  /**\n   * Registers a method that will handle requests sent to the specified\n   * message name.\n   * @param {string} messageName The name of the message to handle.\n   * @param {!RequestHandler} requestHandler\n   */\n  registerHandler(messageName, requestHandler) {\n    this.messageHandlers_[messageName] = requestHandler;\n  }\n\n  /**\n   * Unregisters the handler for the specified message name.\n   * @param {string} messageName The name of the message to unregister.\n   */\n  unregisterHandler(messageName) {\n    delete this.messageHandlers_[messageName];\n  }\n\n  /**\n   * @param {?RequestHandler} requestHandler\n   */\n  setDefaultHandler(requestHandler) {\n    this.defaultHandler_ = requestHandler;\n  }\n\n  /**\n   * Bob sent me a message. I need to decide if it's a new request or\n   * a response to a previous 'conversation' we were having.\n   * @param {!Event} event\n   * @private\n   */\n  handleMessage_(event) {\n    const message = parseMessage(event.data);\n    if (!message || message.app !== APP) {\n      return;\n    }\n    if (\n      this.token_ &&\n      this.verifyToken_ &&\n      message.messagingToken !== this.token_\n    ) {\n      // We received a message with an invalid token - dismiss it.\n      this.logError_(TAG + ': handleMessage_ error: ', 'invalid token');\n      return;\n    }\n    if (message.type === MessageType.REQUEST) {\n      this.handleRequest_(message);\n    } else if (message.type === MessageType.RESPONSE) {\n      this.handleResponse_(message);\n    }\n  }\n\n  /**\n   * I'm sending Bob a new outgoing request.\n   * @param {string} messageName\n   * @param {?JsonObject|string|undefined} messageData\n   * @param {boolean} awaitResponse\n   * @return {!Promise<*>|undefined}\n   */\n  sendRequest(messageName, messageData, awaitResponse) {\n    const requestId = ++this.requestIdCounter_;\n    let promise = undefined;\n    if (awaitResponse) {\n      promise = new Promise((resolve, reject) => {\n        this.waitingForResponse_[requestId] = {resolve, reject};\n      });\n    }\n    this.sendMessage_(\n      /** @type {!AmpViewerMessage} */ ({\n        app: APP,\n        requestid: requestId,\n        type: MessageType.REQUEST,\n        name: messageName,\n        data: messageData,\n        rsvp: awaitResponse,\n      })\n    );\n    return promise;\n  }\n\n  /**\n   * I'm responding to a request that Bob made earlier.\n   * @param {number} requestId\n   * @param {string} messageName\n   * @param {*} messageData\n   * @private\n   */\n  sendResponse_(requestId, messageName, messageData) {\n    this.sendMessage_(\n      /** @type {!AmpViewerMessage} */ ({\n        app: APP,\n        requestid: requestId,\n        type: MessageType.RESPONSE,\n        name: messageName,\n        data: messageData,\n      })\n    );\n  }\n\n  /**\n   * @param {number} requestId\n   * @param {string} messageName\n   * @param {*} reason !Error most of time, string sometimes, * rarely.\n   * @private\n   */\n  sendResponseError_(requestId, messageName, reason) {\n    const errString = this.errorToString_(reason);\n    this.logError_(\n      TAG + ': sendResponseError_, message name: ' + messageName,\n      errString\n    );\n    this.sendMessage_(\n      /** @type {!AmpViewerMessage} */ ({\n        app: APP,\n        requestid: requestId,\n        type: MessageType.RESPONSE,\n        name: messageName,\n        data: null,\n        error: errString,\n      })\n    );\n  }\n\n  /**\n   * @param {!AmpViewerMessage} message\n   * @private\n   */\n  sendMessage_(message) {\n    const /** Object<string, *> */ finalMessage = Object.assign(message, {});\n    if (this.token_ && !this.verifyToken_) {\n      finalMessage.messagingToken = this.token_;\n    }\n    this.port_./*OK*/ postMessage(\n      this.isWebview_\n        ? JSON.stringify(/** @type {!JsonObject} */ (finalMessage))\n        : finalMessage\n    );\n  }\n\n  /**\n   * I'm handling an incoming request from Bob. I'll either respond normally\n   * (ex: \"got it Bob!\") or with an error (ex: \"I didn't get a word of what\n   * you said!\").\n   * @param {!AmpViewerMessage} message\n   * @private\n   */\n  handleRequest_(message) {\n    let handler = this.messageHandlers_[message.name];\n    if (!handler) {\n      handler = this.defaultHandler_;\n    }\n    if (!handler) {\n      const error = new Error(\n        'Cannot handle request because no default handler is set!'\n      );\n      error.args = message.name;\n      throw error;\n    }\n\n    const promise = handler(message.name, message.data, !!message.rsvp);\n    if (message.rsvp) {\n      const requestId = message.requestid;\n      if (!promise) {\n        this.sendResponseError_(\n          requestId,\n          message.name,\n          new Error('no response')\n        );\n        throw new Error('expected response but none given: ' + message.name);\n      }\n      promise.then(\n        data => {\n          this.sendResponse_(requestId, message.name, data);\n        },\n        reason => {\n          this.sendResponseError_(requestId, message.name, reason);\n        }\n      );\n    }\n  }\n\n  /**\n   * I sent out a request to Bob. He responded. And now I'm handling that\n   * response.\n   * @param {!AmpViewerMessage} message\n   * @private\n   */\n  handleResponse_(message) {\n    const requestId = message.requestid;\n    const pending = this.waitingForResponse_[requestId];\n    if (pending) {\n      delete this.waitingForResponse_[requestId];\n      if (message.error) {\n        this.logError_(TAG + ': handleResponse_ error: ', message.error);\n        pending.reject(\n          new Error(`Request ${message.name} failed: ${message.error}`)\n        );\n      } else {\n        pending.resolve(message.data);\n      }\n    }\n  }\n\n  /**\n   * @param {string} state\n   * @param {!Error|string=} opt_data\n   * @private\n   */\n  logError_(state, opt_data) {\n    if (!this.win_) {\n      return;\n    }\n    let stateStr = 'amp-messaging-error-logger: ' + state;\n    const dataStr = ' data: ' + this.errorToString_(opt_data);\n    stateStr += dataStr;\n    this.win_['viewerState'] = stateStr;\n  }\n\n  /**\n   * @param {*} err !Error most of time, string sometimes, * rarely.\n   * @return {string}\n   * @private\n   */\n  errorToString_(err) {\n    return err ? (err.message ? err.message : String(err)) : 'unknown error';\n  }\n}\n","/**\n * Reacts to changes to the AMP document's height and resizes the iframe to\n * adjust to them.\n */\nclass IframeHeightImpl {\n    constructor(frameContainer) {\n        this.documentHeightHandler = (name, data, rsvp) => {\n            this.iframe.setAttribute('height', String(data.height));\n            return Promise.resolve();\n        };\n        this.iframe = frameContainer.getIframe();\n        this.messaging = frameContainer.getMessaging();\n    }\n    start() {\n        this.messaging.registerHandler('documentHeight', this.documentHeightHandler);\n    }\n    documentLoaded() { }\n    documentUnloaded() { }\n}\nfunction load(frameContainer) {\n    const impl = new IframeHeightImpl(frameContainer);\n    impl.start();\n    return impl;\n}\nexport const module = {\n    name: 'IframeHeight',\n    load,\n};\n//# sourceMappingURL=IframeHeight.js.map","/**\n * Reacts to errors received from the AMP document and cancels loading if an\n * unexpected error happens in a short period after the document loads.\n */\nclass ErrorHandlerImpl {\n    constructor(frameContainer) {\n        this.loadErrorRejector = null;\n        this.errorHandler = (name, data, rsvp) => {\n            if (this.loadErrorRejector &&\n                data.a === ErrorType.Developer &&\n                data.ex === ErrorExpectancy.Unexpected) {\n                this.loadErrorRejector(data);\n            }\n            return Promise.resolve();\n        };\n        this.frameContainer = frameContainer;\n        this.messaging = frameContainer.getMessaging();\n        this.config = frameContainer.getConfig();\n    }\n    start() {\n        this.messaging.registerHandler('error', this.errorHandler);\n    }\n    async checkForLoadErrors() {\n        try {\n            await new Promise((resolve, reject) => {\n                this.loadErrorRejector = reject;\n                setTimeout(() => resolve, this.config.failOnLoadErrorAfter);\n            });\n        }\n        catch (error) {\n            this.frameContainer.reportError(error.m);\n        }\n        this.loadErrorRejector = null;\n    }\n    documentLoaded() {\n        if (!this.config.failOnLoadErrorAfter) {\n            return;\n        }\n        this.checkForLoadErrors();\n    }\n    documentUnloaded() { }\n}\nvar ErrorType;\n(function (ErrorType) {\n    ErrorType[\"Developer\"] = \"0\";\n    ErrorType[\"User\"] = \"1\";\n})(ErrorType || (ErrorType = {}));\nvar ErrorExpectancy;\n(function (ErrorExpectancy) {\n    ErrorExpectancy[\"Unexpected\"] = \"0\";\n    ErrorExpectancy[\"Expected\"] = \"1\";\n})(ErrorExpectancy || (ErrorExpectancy = {}));\nfunction load(frameContainer) {\n    const impl = new ErrorHandlerImpl(frameContainer);\n    impl.start();\n    return impl;\n}\nexport const module = {\n    name: 'ErrorHandler',\n    load,\n};\n//# sourceMappingURL=ErrorHandler.js.map","import { module as IframeHeight } from './IframeHeight';\nimport { module as ErrorHandler } from './ErrorHandler';\nexport const modules = [IframeHeight, ErrorHandler];\n//# sourceMappingURL=index.js.map","const FORMAT = 'AMP4EMAIL';\nconst VALIDATOR_JS = 'https://cdn.ampproject.org/v0/validator.js';\n/**\n * Throws if the given code is not valid AMP.\n *\n * @param {string} amp AMP code to validate\n * @param {!Config} config Global config\n * @return {!Promise<string>} Validated AMP code\n */\nasync function process(amp, config) {\n    const validator = await loadValidator();\n    const result = validator.validateString(amp, FORMAT);\n    if (result.status !== 'PASS') {\n        // TODO: add errors inside this object\n        throw new Error('AMP validation failed');\n    }\n    return amp;\n}\n/**\n * Downloads and loads validator.js if it's not already loaded.\n *\n * @return {!Promise<Validator>} Validator object\n */\nfunction loadValidator() {\n    return new Promise(resolve => {\n        if (window.amp && window.amp.validator) {\n            resolve(window.amp.validator);\n            return;\n        }\n        let script = findValidatorJS();\n        if (!script) {\n            script = document.createElement('script');\n            script.src = VALIDATOR_JS;\n            document.body.appendChild(script);\n        }\n        script.addEventListener('load', () => resolve(window.amp.validator));\n    });\n}\n/**\n * Finds an existing script tag with validator.js.\n *\n * @return {?HTMLScriptElement} Script element\n */\nfunction findValidatorJS() {\n    const scripts = Array.from(document.getElementsByTagName('script'));\n    return scripts.find(({ src }) => src === VALIDATOR_JS);\n}\nexport const module = {\n    name: 'Validator',\n    process,\n};\n//# sourceMappingURL=Validator.js.map","import { module as Validator } from './Validator';\nexport const modules = [Validator];\n//# sourceMappingURL=index.js.map","import { modules as preprocessingModules } from './preprocessing-modules/index';\n/**\n * Runs the preprocessing modules on the given AMP code.\n *\n * @param {string} amp AMP code to preprocess\n * @param {!Config} config Global config\n * @param {Array<string>=} modules Module whitelist (leave empty to run all)\n * @return {!Promise<string>} Preprocessed AMP code\n */\nexport async function preprocessAMP(amp, config) {\n    const skipSet = new Set(config.skipPreprocessingModules || []);\n    for (const module of preprocessingModules) {\n        if (skipSet.has(module.name)) {\n            continue;\n        }\n        amp = await module.process(amp, config);\n    }\n    return amp;\n}\n//# sourceMappingURL=preprocess.js.map","import { createIframe } from './createIframe';\nimport { appendParametersToURL, parametersToString } from './viewerParameters';\nimport * as viewerConfig from './viewerConfig';\nimport { Messaging } from '@ampproject/viewer-messaging';\nimport { modules as renderingModules, } from './rendering-modules/index';\n/**\n * Creates an iframe that can render an AMP document, connects it with viewer\n * messaging and loads the rendering modules.\n */\nexport class FrameContainer {\n    /**\n     * @param {!HTMLElement} parent Element to create an iframe inside of\n     * @param {!Config} config Config with parameters related to the AMP viewer\n     */\n    constructor(parent, config) {\n        this.iframe = null;\n        this.messaging = null;\n        this.renderingModules = [];\n        this.documentLoadResolver = null;\n        this.messageHandlers = {};\n        this.messageHandler = (name, data, rsvp) => {\n            console.log(`Received message: ${name} ${JSON.stringify(data)}`);\n            return Promise.resolve();\n        };\n        this.documentLoaded = (name, data, rsvp) => {\n            if (this.documentLoadResolver) {\n                this.documentLoadResolver();\n                this.documentLoadResolver = null;\n            }\n            for (const module of this.renderingModules) {\n                module.documentLoaded();\n            }\n            return Promise.resolve();\n        };\n        this.parent = parent;\n        this.config = config;\n        this.targetOrigin = this.getTargetOrigin();\n        this.messagingToken = this.generateMessagingToken();\n        this.enabledRenderingModules = new Set(viewerConfig.DEFAULT_RENDERING_MODULES);\n    }\n    /**\n     * Renders the provided AMP code inside the frame container.\n     *\n     * @param {string} amp AMP code to display\n     * @return {!Promise} Resolves when rendered\n     */\n    async render(amp) {\n        if (this.iframe) {\n            this.parent.removeChild(this.iframe);\n            this.iframe = null;\n            this.unloadDocument();\n        }\n        this.createViewerIframe(amp);\n        if (!this.config.useSrcDoc) {\n            await this.injectAMP(amp);\n        }\n        this.startLoadingTimer();\n        await this.startMessaging();\n    }\n    /**\n     * Unloads the AMP document and displays an error in its place.\n     *\n     * @param {string=} error Information about the error\n     */\n    reportError(error) {\n        if (!this.iframe) {\n            return;\n        }\n        this.unloadDocument();\n        let message = 'Error loading AMP page.';\n        if (error) {\n            message += '\\n' + error;\n        }\n        this.iframe.src = 'data:text/plain;base64,' + btoa(message);\n        this.iframe.setAttribute('height', '50');\n    }\n    /**\n     * Returns the iframe element that contains an AMP page.\n     *\n     * @return {!HTMLIFrameElement}\n     */\n    getIframe() {\n        if (!this.iframe) {\n            throw new Error('iframe not initialized yet');\n        }\n        return this.iframe;\n    }\n    /**\n     * Returns the Messaging object used to communicate with the AMP page.\n     *\n     * @return {!Messaging}\n     */\n    getMessaging() {\n        if (!this.messaging) {\n            throw new Error('Messaging not initialized yet');\n        }\n        return this.messaging;\n    }\n    /**\n     * Returns the Config.\n     *\n     * @return {!Config}\n     */\n    getConfig() {\n        return this.config;\n    }\n    /**\n     * Enables the given rendering module. Must be called before render.\n     *\n     * @param {string} module Name of module to enable\n     */\n    enableRenderingModule(module) {\n        this.enabledRenderingModules.add(module);\n    }\n    /**\n     * Disables the given rendering module. Must be called before render.\n     *\n     * @param {string} module Name of module to disable\n     */\n    disableRenderingModule(module) {\n        this.enabledRenderingModules.delete(module);\n    }\n    registerMessageHandler(messageName, handler) {\n        this.messageHandlers[messageName] = handler;\n    }\n    unloadDocument() {\n        this.messaging = null;\n        for (const module of this.renderingModules) {\n            module.documentUnloaded();\n        }\n        this.renderingModules = [];\n    }\n    createViewerIframe(amp) {\n        const iframeOptions = {\n            width: '100%',\n            height: '1',\n            featurePolicy: viewerConfig.IFRAME_FEATURE_POLICY,\n            sandbox: this.getIframeSandbox(),\n            styles: viewerConfig.IFRAME_STYLES,\n        };\n        if (this.config.useSrcDoc) {\n            iframeOptions.srcdoc = amp;\n            iframeOptions.name = this.getIframeName();\n        }\n        else {\n            iframeOptions.src = this.getIframeSrc();\n        }\n        this.iframe = createIframe(this.parent, iframeOptions);\n    }\n    async waitForIframeLoad() {\n        return new Promise(resolve => {\n            this.iframe.addEventListener('load', () => resolve());\n        });\n    }\n    async injectAMP(amp) {\n        await this.waitForIframeLoad();\n        this.iframe.contentWindow.postMessage({ amp }, '*');\n    }\n    async startLoadingTimer() {\n        try {\n            await new Promise((resolve, reject) => {\n                this.documentLoadResolver = resolve;\n                if (this.config.loadTimeout) {\n                    setTimeout(() => reject(), this.config.loadTimeout);\n                }\n            });\n        }\n        catch (e) {\n            this.reportError('Loading timeout');\n        }\n    }\n    async startMessaging() {\n        const target = this.iframe.contentWindow;\n        const messaging = await Messaging.waitForHandshakeFromDocument(window, target, this.targetOrigin, this.messagingToken);\n        this.messaging = messaging;\n        this.messaging.setDefaultHandler(this.messageHandler);\n        this.messaging.registerHandler('documentLoaded', this.documentLoaded);\n        Object.keys(this.messageHandlers).forEach((messageName) => {\n            this.messaging?.registerHandler(messageName, this.messageHandlers[messageName]);\n        });\n        this.loadRenderingModules();\n        this.messaging.sendRequest('visibilitychange', {}, true);\n    }\n    loadRenderingModules() {\n        for (const module of renderingModules) {\n            if (this.enabledRenderingModules.has(module.name)) {\n                this.renderingModules.push(module.load(this));\n            }\n        }\n    }\n    getIframeSandbox() {\n        if (this.config.useOpaqueOrigin) {\n            return viewerConfig.IFRAME_SANDBOX;\n        }\n        return viewerConfig.IFRAME_SANDBOX.concat('allow-same-origin');\n    }\n    getIframeSrc() {\n        return appendParametersToURL(this.config.relayPageURL, this.getIframeParameters());\n    }\n    getIframeParameters() {\n        return Object.assign({\n            origin: window.location.origin,\n            messagingToken: this.messagingToken,\n        }, viewerConfig.VIEWER_PARAMETERS);\n    }\n    getIframeName() {\n        return '__AMP__' + parametersToString(this.getIframeParameters());\n    }\n    generateMessagingToken() {\n        const bytes = new Uint8Array(32);\n        window.crypto.getRandomValues(bytes);\n        const bytesStr = String.fromCharCode.apply(null, Array.from(bytes));\n        return btoa(bytesStr);\n    }\n    getTargetOrigin() {\n        if (this.config.useOpaqueOrigin) {\n            return 'null';\n        }\n        return new URL(this.config.relayPageURL).origin;\n    }\n}\n//# sourceMappingURL=FrameContainer.js.map"],"names":["stringIfArray","a","Array","input","n","p","ViewerCapability","CLIENT_ID_SERVICE","ViewerViewportType","r","ViewerVisibilityState","u","parameters","key","output","value","encodeURIComponent","IFRAME_FEATURE_POLICY","IFRAME_SANDBOX","IFRAME_STYLES","VIEWER_PARAMETERS","prerenderSize","visibilityState","paddingTop","history","p2r","horizontalScrolling","storage","development","log","csi","cap","DEFAULT_RENDERING_MODULES","message","e","[object Object]","win","origin","target","this","eventType","handler","event","data","opt_token","Promise","resolve","channel","MessageChannel","err","console","pollMessage","app","name","port","listener","parseMessage","clearInterval","intervalRef","messaging","Messaging","source","WindowPortEmulator","opt_isWebview","opt_verifyToken","messageName","requestHandler","MessageType","messageData","awaitResponse","promise","undefined","reject","requestId","requestid","type","rsvp","reason","errString","error","finalMessage","JSON","Error","pending","state","opt_data","stateStr","dataStr","String","frameContainer","ErrorType","ErrorExpectancy","_this","L","M","modules","module","load","impl","IframeHeightImpl","module$1","load$1","ErrorHandlerImpl","amp","FORMAT","loadValidator","window","script","document","src","VALIDATOR_JS","module$2","process","config","skipSet","Set","parent","viewerConfig.DEFAULT_RENDERING_MODULES","btoa","iframeOptions","width","height","featurePolicy","viewerConfig.IFRAME_FEATURE_POLICY","sandbox","styles","viewerConfig.IFRAME_STYLES","iframe","_this2","_this4","setTimeout","_this5","viewerConfig.IFRAME_SANDBOX","relayPageURL","b","url","parametersToString","messagingToken","viewerConfig.VIEWER_PARAMETERS","bytes","Uint8Array","bytesStr","URL"],"mappings":"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"}